<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Macro Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="manifest" href="manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 500px; margin: auto; }
    input, select, button { margin: 5px 0; width: 100%; padding: 8px; }
    hr { margin: 20px 0; }
  </style>
</head>
<body>

  <h2>Macro Target Generator</h2>
  <select id="phase">
    <option value="none">None</option>
    <option value="explonic">Explonic</option>
    <option value="adaptive">Adaptive</option>
    <option value="negative">Negative</option>
  </select>

  <input type="number" id="milesBiked" placeholder="Miles biked">
  <input type="checkbox" id="workDay"> Work day<br>
  <input type="number" id="workoutCalories" placeholder="Workout calories burned">

  <input type="number" id="weight" placeholder="Weight (lbs)">
  <select id="goal">
    <option value="maintain">Maintain</option>
    <option value="gain">Gain</option>
    <option value="cut">Cut</option>
  </select>

  <button onclick="generateTargets()">Generate Targets</button>

  <hr>

  <h3>Set Daily Targets</h3>
  Calories: <input type="number" id="targetCalories"><br>
  Protein (g): <input type="number" id="targetProtein"><br>
  Carbs (g): <input type="number" id="targetCarbs"><br>
  Fat (g): <input type="number" id="targetFat"><br>
  <button onclick="setTargets()">Set Targets</button>

  <hr>

  <h3>Today's Intake</h3>
  <div id="totalsDisplay"></div>

  <hr>

  <h3>Add Intake</h3>
  Calories: <input type="number" id="addCalories"><br>
  Protein: <input type="number" id="addProtein"><br>
  Carbs: <input type="number" id="addCarbs"><br>
  Fat: <input type="number" id="addFat"><br>
  <button onclick="addIntake()">Add</button>

  <hr>
  <button onclick="resetDay()">Reset Day</button>

  <script>
    let totals = { calories: 0, protein: 0, carbs: 0, fat: 0 };
    let targets = { calories: "", protein: "", carbs: "", fat: "" };

    function loadData() {
      const savedTotals = localStorage.getItem("macroTotals");
      const savedTargets = localStorage.getItem("macroTargets");

      if (savedTotals) totals = JSON.parse(savedTotals);
      if (savedTargets) targets = JSON.parse(savedTargets);

      document.getElementById("targetCalories").value = targets.calories || "";
      document.getElementById("targetProtein").value = targets.protein || "";
      document.getElementById("targetCarbs").value = targets.carbs || "";
      document.getElementById("targetFat").value = targets.fat || "";

      updateDisplay();
    }

    function saveTotals() {
      localStorage.setItem("macroTotals", JSON.stringify(totals));
    }

    function setTargets() {
      targets.calories = document.getElementById("targetCalories").value;
      targets.protein = document.getElementById("targetProtein").value;
      targets.carbs = document.getElementById("targetCarbs").value;
      targets.fat = document.getElementById("targetFat").value;
      localStorage.setItem("macroTargets", JSON.stringify(targets));
      updateDisplay();
    }

    function generateTargets() {
      const weight = Number(document.getElementById("weight").value);
      const miles = Number(document.getElementById("milesBiked").value);
      const workDay = document.getElementById("workDay").checked;
      const workoutCalories = Number(document.getElementById("workoutCalories").value) || 0;
      const phase = document.getElementById("phase").value;
      const goal = document.getElementById("goal").value;

      const bmr = weight * 10;
      let multiplier = 1.2;
      multiplier += (miles / 5) * 0.05;
      if (workDay) multiplier += 0.25;

      let calorieMod = 1;
      let proteinMod = 1;
      let fatMod = 1;

      if (phase === "explonic") {
        calorieMod = 1.1;
        proteinMod = 1.15;
      } else if (phase === "adaptive") {
        calorieMod = 1.05;
        proteinMod = 1.1;
      } else if (phase === "negative") {
        calorieMod = 1.05;
        proteinMod = 1.15;
        fatMod = 1.1;
      }

      let macroSplit;
      if (goal === "gain") {
        macroSplit = { carbs: 0.45, protein: 0.35, fat: 0.2 };
      } else if (goal === "cut") {
        macroSplit = { carbs: 0.3, protein: 0.4, fat: 0.3 };
      } else {
        macroSplit = { carbs: 0.4, protein: 0.3, fat: 0.3 };
      }

      const baseCalories = Math.round(bmr * multiplier * calorieMod);
      const calories = baseCalories + workoutCalories;

      const protein = Math.round((calories * macroSplit.protein * proteinMod) / 4);
      const carbs = Math.round((calories * macroSplit.carbs) / 4);
      const fat = Math.round((calories * macroSplit.fat * fatMod) / 9);

      targets = { calories, protein, carbs, fat };
      localStorage.setItem("macroTargets", JSON.stringify(targets));
      updateDisplay();
    }

    function updateDisplay() {
      document.getElementById('totalsDisplay').innerHTML = `
        Calories: ${totals.calories} / ${targets.calories || "—"}<br>
        Protein: ${totals.protein}g / ${targets.protein || "—"}g<br>
        Carbs: ${totals.carbs}g / ${targets.carbs || "—"}g<br>
        Fat: ${totals.fat}g / ${targets.fat || "—"}g
      `;
    }

    function addIntake() {
      totals.calories += Number(document.getElementById('addCalories').value) || 0;
      totals.protein += Number(document.getElementById('addProtein').value) || 0;
      totals.carbs += Number(document.getElementById('addCarbs').value) || 0;
      totals.fat += Number(document.getElementById('addFat').value) || 0;
      saveTotals();
      updateDisplay();
    }

    function resetDay() {
      totals = { calories: 0, protein: 0, carbs: 0, fat: 0 };
      targets = { calories: "", protein: "", carbs: "", fat: "" };
      localStorage.removeItem("macroTotals");
      localStorage.removeItem("macroTargets");

      document.getElementById("targetCalories").value = "";
      document.getElementById("targetProtein").value = "";
      document.getElementById("targetCarbs").value = "";
      document.getElementById("targetFat").value = "";

      updateDisplay();
    }

    document.addEventListener("DOMContentLoaded", loadData);
  </script>
</body>
</html>
